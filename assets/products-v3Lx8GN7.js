import{r as y,j as e}from"./client-DD4c7S6m.js";const $=t=>{const{quantity:s,product:a}=t,{discounts:n}=a,c=n.filter(i=>s>=i.quantity);return c.length===0?0:Math.max(...c.map(i=>i.rate))},A=(t,s)=>{let a=0;const n=t.reduce((c,i)=>{const{quantity:o,product:u}=i;a+=$(i)*u.price*o;const h=o*u.price;return c+h},0);return s&&(s.discountType==="amount"?a+=s.discountValue:a+=(n-a)*(s.discountValue/100)),{totalBeforeDiscount:n,totalAfterDiscount:n-a,totalDiscount:a}},F=(t,s,a)=>a<=0?t.filter(c=>c.product.id!==s):t.map(c=>{if(c.product.id===s){const i=c.product.stock>=a?a:c.product.stock;return{...c,quantity:i}}return c}),M=()=>{const[t,s]=y.useState([]),[a,n]=y.useState(null),c=r=>{v(r)<=0||s(p=>p.find(j=>j.product.id===r.id)?p.map(j=>j.product.id===r.id?{...j,quantity:Math.min(j.quantity+1,r.stock)}:j):[...p,{product:r,quantity:1}])},i=r=>{const g=t.filter(p=>p.product.id!==r);s(g)},o=(r,g)=>{s(p=>F(p,r,g))},u=r=>{n(r)},h=()=>A(t,a),v=r=>{const g=t.find(p=>p.product.id===r.id);return r.stock-((g==null?void 0:g.quantity)||0)};return{cart:t,addToCart:c,removeFromCart:i,updateQuantity:o,applyCoupon:u,calculateTotal:h,selectedCoupon:a}},f=({sectionTitle:t})=>e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:t}),L=(t,s)=>{const a=s.find(n=>n.product.id===t.id);return t.stock-((a==null?void 0:a.quantity)||0)},R=t=>t.reduce((s,a)=>Math.max(s,a.rate),0),E=({products:t,cart:s,addToCart:a})=>e.jsxs("div",{children:[e.jsx(f,{sectionTitle:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(n=>{const c=L(n,s);return e.jsxs("div",{"data-testid":`product-${n.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:n.name}),e.jsxs("span",{className:"text-gray-600",children:[n.price.toLocaleString(),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${c>0?"text-green-600":"text-red-600"}`,children:["재고: ",c,"개"]}),n.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(R(n.discounts)*100).toFixed(0),"% 할인"]})]}),n.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:n.discounts.map((i,o)=>e.jsxs("li",{children:[i.quantity,"개 이상:"," ",(i.rate*100).toFixed(0),"% 할인"]},o))}),e.jsx("button",{onClick:()=>a(n),className:`w-full px-3 py-1 rounded ${c>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:c<=0,children:c>0?"장바구니에 추가":"품절"})]},n.id)})})]}),N=({children:t,className:s="",...a})=>e.jsx("div",{className:`bg-white p-4 rounded shadow ${s}`,...a,children:t}),B=({coupons:t,selectedCoupon:s,onChange:a})=>e.jsxs(N,{className:"mt-4",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:n=>a(t[parseInt(n.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),t.map((n,c)=>e.jsxs("option",{value:c,children:[n.name," -"," ",n.discountType==="amount"?`${n.discountValue}원`:`${n.discountValue}%`]},n.code))]}),s&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",s.name,"(",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," ","할인)"]})]}),O=t=>{const{discounts:s}=t.product,{quantity:a}=t;let n=0;for(const c of s)a>=c.quantity&&(n=Math.max(n,c.rate));return n},Q=({item:t,onIncrease:s,onDecrease:a,onRemove:n})=>{const c=O(t);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price,"원 x ",t.quantity,c>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(c*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:a,className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:s,className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:n,className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]})]},t.product.id)},U=({totalAfterDiscount:t,totalDiscount:s,totalBeforeDiscount:a})=>e.jsxs(N,{className:"mt-4",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",a.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",s.toLocaleString(),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",t.toLocaleString(),"원"]})]})]}),W=({coupons:t,cart:s,selectedCoupon:a,calculateTotal:n,removeFromCart:c,updateQuantity:i,applyCoupon:o})=>{const{totalBeforeDiscount:u,totalAfterDiscount:h,totalDiscount:v}=n();return e.jsxs("div",{children:[e.jsx(f,{sectionTitle:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:s.map(r=>e.jsx(Q,{item:r,onIncrease:()=>i(r.product.id,r.quantity+1),onDecrease:()=>i(r.product.id,r.quantity-1),onRemove:()=>c(r.product.id)},r.product.id))}),e.jsx(B,{coupons:t,selectedCoupon:a,onChange:o}),e.jsx(U,{totalBeforeDiscount:u,totalDiscount:v,totalAfterDiscount:h})]})},k=({title:t,children:s})=>e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:t}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s})]}),Y=({products:t,coupons:s})=>{const{cart:a,addToCart:n,removeFromCart:c,updateQuantity:i,applyCoupon:o,calculateTotal:u,selectedCoupon:h}=M();return e.jsxs(k,{title:"장바구니",children:[e.jsx(E,{products:t,cart:a,addToCart:n}),e.jsx(W,{coupons:s,cart:a,selectedCoupon:h,calculateTotal:u,removeFromCart:c,updateQuantity:i,applyCoupon:o})]})},b=({label:t,id:s,type:a="text",value:n,onChange:c,placeholder:i,inputClassName:o="w-full p-2 border rounded",labelClassName:u="block text-sm font-medium text-gray-700",...h})=>e.jsxs("div",{className:"mb-2",children:[t&&e.jsx("label",{htmlFor:s,className:u,children:t}),e.jsx("input",{id:s,type:a,value:n,onChange:c,placeholder:i,className:o,...h})]}),_=({product:t,setProduct:s,onSubmit:a})=>e.jsxs(N,{children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsx("div",{className:"mb-2",children:e.jsx(b,{label:"상품명",id:"productName",type:"text",value:t.name,onChange:n=>s({...t,name:n.target.value})})}),e.jsx("div",{className:"mb-2",children:e.jsx(b,{label:"가격",id:"productPrice",type:"number",value:t.price,onChange:n=>s({...t,price:parseInt(n.target.value)})})}),e.jsx("div",{className:"mb-2",children:e.jsx(b,{label:"재고",id:"productStock",type:"number",value:t.stock,onChange:n=>s({...t,stock:parseInt(n.target.value)})})}),e.jsx("button",{onClick:a,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),z=({products:t,onProductUpdate:s,onProductAdd:a})=>{const[n,c]=y.useState(new Set),[i,o]=y.useState(null),[u,h]=y.useState({quantity:0,rate:0}),[v,r]=y.useState(!1),[g,p]=y.useState({name:"",price:0,stock:0,discounts:[]}),C=l=>{c(x=>{const d=new Set(x);return d.has(l)?d.delete(l):d.add(l),d})},j=l=>{o({...l})},w=(l,x)=>{if(i&&i.id===l){const d={...i,name:x};o(d)}},S=(l,x)=>{if(i&&i.id===l){const d={...i,price:x};o(d)}},P=()=>{i&&(s(i),o(null))},q=(l,x)=>{const d=t.find(m=>m.id===l);if(d){const m={...d,stock:x};s(m),o(m)}},T=l=>{const x=t.find(d=>d.id===l);if(x&&i){const d={...x,discounts:[...x.discounts,u]};s(d),o(d),h({quantity:0,rate:0})}},D=(l,x)=>{const d=t.find(m=>m.id===l);if(d){const m={...d,discounts:d.discounts.filter((K,I)=>I!==x)};s(m),o(m)}},V=()=>{const l={...g,id:Date.now().toString()};a(l),p({name:"",price:0,stock:0,discounts:[]}),r(!1)};return e.jsxs("div",{children:[e.jsx(f,{sectionTitle:"상품 관리"}),e.jsx("button",{onClick:()=>r(!v),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:v?"취소":"새 상품 추가"}),v&&e.jsx(_,{product:g,setProduct:p,onSubmit:V}),e.jsx("div",{className:"space-y-2",children:t.map((l,x)=>e.jsxs(N,{"data-testid":`product-${x+1}`,children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>C(l.id),className:"w-full text-left font-semibold",children:[l.name," - ",l.price,"원 (재고: ",l.stock,")"]}),n.has(l.id)&&e.jsx("div",{className:"mt-2",children:i&&i.id===l.id?e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsx(b,{label:"상품명: ",id:"productName",type:"text",value:i.name,onChange:d=>w(l.id,d.target.value),labelClassName:"block mb-1"})}),e.jsx("div",{className:"mb-4",children:e.jsx(b,{label:"가격: ",id:"productPrice",type:"number",value:i.price,onChange:d=>S(l.id,parseInt(d.target.value)),labelClassName:"block mb-1"})}),e.jsx("div",{className:"mb-4",children:e.jsx(b,{label:"재고: ",id:"productStock",type:"number",value:i.stock,onChange:d=>q(l.id,parseInt(d.target.value)),labelClassName:"block mb-1"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),i.discounts.map((d,m)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[d.quantity,"개 이상 구매 시"," ",d.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>D(l.id,m),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},m)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(b,{id:"discountQuantity",type:"number",placeholder:"수량",value:u.quantity,onChange:d=>h({...u,quantity:parseInt(d.target.value)}),inputClassName:"w-1/3 p-2 border rounded"}),e.jsx(b,{id:"discountRate",type:"number",placeholder:"할인율 (%)",value:u.rate*100,onChange:d=>h({...u,rate:parseInt(d.target.value)/100}),inputClassName:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>T(l.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:P,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[l.discounts.map((d,m)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[d.quantity,"개 이상 구매 시"," ",d.rate*100,"% 할인"]})},m)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>j(l),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},l.id))})]})},G=({newCoupon:t,setNewCoupon:s,onSubmit:a})=>e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx(b,{id:"coupon-name",type:"text",placeholder:"쿠폰 이름",value:t.name,onChange:n=>s({...t,name:n.target.value})}),e.jsx(b,{id:"coupon-code",type:"text",placeholder:"쿠폰 코드",value:t.code,onChange:n=>s({...t,code:n.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t.discountType,onChange:n=>s({...t,discountType:n.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx(b,{id:"discount-value",type:"number",placeholder:"할인 값",value:t.discountValue,onChange:n=>s({...t,discountValue:parseInt(n.target.value)})})]}),e.jsx("button",{onClick:a,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),H=({coupons:t})=>t.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"등록된 쿠폰이 없습니다."}):e.jsx("div",{className:"space-y-2",children:t.map((s,a)=>e.jsxs("div",{"data-testid":`coupon-${a+1}`,className:"bg-gray-100 p-2 rounded",children:[s.name," (",s.code,"):",s.discountType==="amount"?`${s.discountValue}원`:`${s.discountValue}%`," ","할인"]},a))}),J=({coupons:t,onCouponAdd:s})=>{const[a,n]=y.useState({name:"",code:"",discountType:"percentage",discountValue:0}),c=()=>{s(a),n({name:"",code:"",discountType:"percentage",discountValue:0})};return e.jsxs("div",{children:[e.jsx(f,{sectionTitle:"쿠폰 관리"}),e.jsxs(N,{children:[e.jsx(G,{newCoupon:a,setNewCoupon:n,onSubmit:c}),e.jsx(H,{coupons:t})]})]})},Z=({products:t,coupons:s,onProductUpdate:a,onProductAdd:n,onCouponAdd:c})=>e.jsxs(k,{title:"관리자 페이지",children:[e.jsx(z,{products:t,onProductUpdate:a,onProductAdd:n}),e.jsx(J,{coupons:s,onCouponAdd:c})]}),ee=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:"amount",discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:"percentage",discountValue:10}],te=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}];export{Z as A,Y as C,te as P,ee as a};
