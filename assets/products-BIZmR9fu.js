import{r as y,j as e}from"./client-DD4c7S6m.js";const f={AMOUNT:"amount",PERCENTAGE:"percentage"},R=t=>{const{quantity:s,product:a}=t,{discounts:n}=a,c=n.filter(r=>s>=r.quantity);return c.length===0?0:Math.max(...c.map(r=>r.rate))},$=(t,s)=>{let a=0;const n=t.reduce((c,r)=>{const{quantity:l,product:u}=r;a+=R(r)*u.price*l;const p=l*u.price;return c+p},0);return s&&(s.discountType===f.AMOUNT?a+=s.discountValue:a+=(n-a)*(s.discountValue/100)),{totalBeforeDiscount:n,totalAfterDiscount:n-a,totalDiscount:a}},O=(t,s,a)=>a<=0?t.filter(c=>c.product.id!==s):t.map(c=>{if(c.product.id===s){const r=c.product.stock>=a?a:c.product.stock;return{...c,quantity:r}}return c}),k=(t,s)=>{const a=s.find(n=>n.product.id===t.id);return t.stock-((a==null?void 0:a.quantity)||0)},U=t=>t.reduce((s,a)=>Math.max(s,a.rate),0),L=()=>{const[t,s]=y.useState([]),[a,n]=y.useState(null);return{cart:t,addToCart:o=>{k(o,t)<=0||s(j=>j.find(g=>g.product.id===o.id)?j.map(g=>g.product.id===o.id?{...g,quantity:Math.min(g.quantity+1,o.stock)}:g):[...j,{product:o,quantity:1}])},removeFromCart:o=>{const x=t.filter(j=>j.product.id!==o);s(x)},updateQuantity:(o,x)=>{s(j=>O(j,o,x))},applyCoupon:o=>{n(o)},calculateTotal:()=>$(t,a),selectedCoupon:a}},C=({sectionTitle:t})=>e.jsx("h2",{className:"text-2xl font-semibold mb-4",children:t}),N=t=>t.toLocaleString(),B=({product:t,remainingStock:s,onAddToCart:a})=>e.jsxs("div",{"data-testid":`product-${t.id}`,className:"bg-white p-3 rounded shadow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-gray-600",children:[N(t.price),"원"]})]}),e.jsxs("div",{className:"text-sm text-gray-500 mb-2",children:[e.jsxs("span",{className:`font-medium ${s>0?"text-green-600":"text-red-600"}`,children:["재고: ",s,"개"]}),t.discounts.length>0&&e.jsxs("span",{className:"ml-2 font-medium text-blue-600",children:["최대 ",(U(t.discounts)*100).toFixed(0),"% 할인"]})]}),t.discounts.length>0&&e.jsx("ul",{className:"list-disc list-inside text-sm text-gray-500 mb-2",children:t.discounts.map((n,c)=>e.jsxs("li",{children:[n.quantity,"개 이상: ",(n.rate*100).toFixed(0),"% 할인"]},c))}),e.jsx("button",{onClick:()=>a(t),className:`w-full px-3 py-1 rounded ${s>0?"bg-blue-500 text-white hover:bg-blue-600":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:s<=0,children:s>0?"장바구니에 추가":"품절"})]},t.id),G=({products:t,cart:s,addToCart:a})=>e.jsxs("div",{children:[e.jsx(C,{sectionTitle:"상품 목록"}),e.jsx("div",{className:"space-y-2",children:t.map(n=>{const c=k(n,s);return e.jsx(B,{product:n,remainingStock:c,onAddToCart:a},n.id)})})]}),v=({children:t,className:s="",...a})=>e.jsx("div",{className:`bg-white p-4 rounded shadow ${s}`,...a,children:t}),T=(t,s)=>t===f.AMOUNT?`${N(s)}원`:`${s}%`,Q=({coupons:t,selectedCoupon:s,onChange:a})=>e.jsxs(v,{className:"mt-4",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"쿠폰 적용"}),e.jsxs("select",{onChange:n=>a(t[parseInt(n.target.value)]),className:"w-full p-2 border rounded mb-2",children:[e.jsx("option",{value:"",children:"쿠폰 선택"}),t.map((n,c)=>e.jsxs("option",{value:c,children:[n.name," -"," ",T(n.discountType,n.discountValue)," "]},n.code))]}),s&&e.jsxs("p",{className:"text-green-600",children:["적용된 쿠폰: ",s.name,"(",T(s.discountType,s.discountValue)," ","할인)"]})]}),_=t=>{const{discounts:s}=t.product,{quantity:a}=t;let n=0;for(const c of s)a>=c.quantity&&(n=Math.max(n,c.rate));return n},W=({onIncrease:t,onDecrease:s,onRemove:a,disabled:n=!1})=>e.jsxs("div",{children:[e.jsx("button",{onClick:s,disabled:n,"aria-label":"수량 감소",className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"-"}),e.jsx("button",{onClick:t,disabled:n,"aria-label":"수량 증가",className:"bg-gray-300 text-gray-800 px-2 py-1 rounded mr-1 hover:bg-gray-400",children:"+"}),e.jsx("button",{onClick:a,"aria-label":"삭제",className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]}),Y=({item:t,onIncrease:s,onDecrease:a,onRemove:n})=>{const c=_(t);return e.jsxs("div",{className:"flex justify-between items-center bg-white p-3 rounded shadow",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-semibold",children:t.product.name}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm text-gray-600",children:[t.product.price,"원 x ",t.quantity,c>0&&e.jsxs("span",{className:"text-green-600 ml-1",children:["(",(c*100).toFixed(0),"% 할인 적용)"]})]})]}),e.jsx(W,{onIncrease:s,onDecrease:a,onRemove:n})]})},z=({totalAfterDiscount:t,totalDiscount:s,totalBeforeDiscount:a})=>e.jsxs(v,{className:"mt-4",children:[e.jsx("h2",{className:"text-2xl font-semibold mb-2",children:"주문 요약"}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{children:["상품 금액: ",N(a),"원"]}),e.jsxs("p",{className:"text-green-600",children:["할인 금액: ",N(s),"원"]}),e.jsxs("p",{className:"text-xl font-bold",children:["최종 결제 금액: ",N(t),"원"]})]})]}),H=({coupons:t,cart:s,selectedCoupon:a,calculateTotal:n,removeFromCart:c,updateQuantity:r,applyCoupon:l})=>{const{totalBeforeDiscount:u,totalAfterDiscount:p,totalDiscount:o}=n();return e.jsxs("div",{children:[e.jsx(C,{sectionTitle:"장바구니 내역"}),e.jsx("div",{className:"space-y-2",children:s.map(x=>e.jsx(Y,{item:x,onIncrease:()=>r(x.product.id,x.quantity+1),onDecrease:()=>r(x.product.id,x.quantity-1),onRemove:()=>c(x.product.id)},x.product.id))}),e.jsx(Q,{coupons:t,selectedCoupon:a,onChange:l}),e.jsx(z,{totalBeforeDiscount:u,totalDiscount:o,totalAfterDiscount:p})]})},P=({title:t,children:s})=>e.jsxs("div",{className:"container mx-auto p-4",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:t}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:s})]}),ae=({products:t,coupons:s})=>{const{cart:a,addToCart:n,removeFromCart:c,updateQuantity:r,applyCoupon:l,calculateTotal:u,selectedCoupon:p}=L();return e.jsxs(P,{title:"장바구니",children:[e.jsx(G,{products:t,cart:a,addToCart:n}),e.jsx(H,{coupons:s,cart:a,selectedCoupon:p,calculateTotal:u,removeFromCart:c,updateQuantity:r,applyCoupon:l})]})},b=({label:t,id:s,type:a="text",value:n,onChange:c,placeholder:r,inputClassName:l="w-full p-2 border rounded",labelClassName:u="block text-sm font-medium text-gray-700",...p})=>e.jsxs("div",{className:"mb-2",children:[t&&e.jsx("label",{htmlFor:s,className:u,children:t}),e.jsx("input",{id:s,type:a,value:n,onChange:c,placeholder:r,className:l,...p})]}),J=({product:t,setProduct:s,onSubmit:a})=>e.jsxs(v,{children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:"새 상품 추가"}),e.jsx("div",{className:"mb-2",children:e.jsx(b,{label:"상품명",id:"productName",type:"text",value:t.name,onChange:n=>s({...t,name:n.target.value})})}),e.jsx("div",{className:"mb-2",children:e.jsx(b,{label:"가격",id:"productPrice",type:"number",value:t.price,onChange:n=>s({...t,price:parseInt(n.target.value)})})}),e.jsx("div",{className:"mb-2",children:e.jsx(b,{label:"재고",id:"productStock",type:"number",value:t.stock,onChange:n=>s({...t,stock:parseInt(n.target.value)})})}),e.jsx("button",{onClick:a,className:"w-full bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"추가"})]}),K=({products:t,onProductUpdate:s,onProductAdd:a})=>{const[n,c]=y.useState(new Set),[r,l]=y.useState(null),[u,p]=y.useState({quantity:0,rate:0}),[o,x]=y.useState(!1),[j,w]=y.useState({name:"",price:0,stock:0,discounts:[]}),g=d=>{c(m=>{const i=new Set(m);return i.has(d)?i.delete(d):i.add(d),i})},q=d=>{l({...d})},S=(d,m)=>{if(r&&r.id===d){const i={...r,name:m};l(i)}},A=(d,m)=>{if(r&&r.id===d){const i={...r,price:m};l(i)}},D=()=>{r&&(s(r),l(null))},I=(d,m)=>{const i=t.find(h=>h.id===d);if(i){const h={...i,stock:m};s(h),l(h)}},E=d=>{const m=t.find(i=>i.id===d);if(m&&r){const i={...m,discounts:[...m.discounts,u]};s(i),l(i),p({quantity:0,rate:0})}},M=(d,m)=>{const i=t.find(h=>h.id===d);if(i){const h={...i,discounts:i.discounts.filter((se,F)=>F!==m)};s(h),l(h)}},V=()=>{const d={...j,id:Date.now().toString()};a(d),w({name:"",price:0,stock:0,discounts:[]}),x(!1)};return e.jsxs("div",{children:[e.jsx(C,{sectionTitle:"상품 관리"}),e.jsx("button",{onClick:()=>x(!o),className:"bg-green-500 text-white px-4 py-2 rounded mb-4 hover:bg-green-600",children:o?"취소":"새 상품 추가"}),o&&e.jsx(J,{product:j,setProduct:w,onSubmit:V}),e.jsx("div",{className:"space-y-2",children:t.map((d,m)=>e.jsxs(v,{"data-testid":`product-${m+1}`,children:[e.jsxs("button",{"data-testid":"toggle-button",onClick:()=>g(d.id),className:"w-full text-left font-semibold",children:[d.name," - ",d.price,"원 (재고: ",d.stock,")"]}),n.has(d.id)&&e.jsx("div",{className:"mt-2",children:r&&r.id===d.id?e.jsxs("div",{children:[e.jsx("div",{className:"mb-4",children:e.jsx(b,{label:"상품명: ",id:"productName",type:"text",value:r.name,onChange:i=>S(d.id,i.target.value),labelClassName:"block mb-1"})}),e.jsx("div",{className:"mb-4",children:e.jsx(b,{label:"가격: ",id:"productPrice",type:"number",value:r.price,onChange:i=>A(d.id,parseInt(i.target.value)),labelClassName:"block mb-1"})}),e.jsx("div",{className:"mb-4",children:e.jsx(b,{label:"재고: ",id:"productStock",type:"number",value:r.stock,onChange:i=>I(d.id,parseInt(i.target.value)),labelClassName:"block mb-1"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-lg font-semibold mb-2",children:"할인 정보"}),r.discounts.map((i,h)=>e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("span",{children:[i.quantity,"개 이상 구매 시"," ",i.rate*100,"% 할인"]}),e.jsx("button",{onClick:()=>M(d.id,h),className:"bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600",children:"삭제"})]},h)),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(b,{id:"discountQuantity",type:"number",placeholder:"수량",value:u.quantity,onChange:i=>p({...u,quantity:parseInt(i.target.value)}),inputClassName:"w-1/3 p-2 border rounded"}),e.jsx(b,{id:"discountRate",type:"number",placeholder:"할인율 (%)",value:u.rate*100,onChange:i=>p({...u,rate:parseInt(i.target.value)/100}),inputClassName:"w-1/3 p-2 border rounded"}),e.jsx("button",{onClick:()=>E(d.id),className:"w-1/3 bg-blue-500 text-white p-2 rounded hover:bg-blue-600",children:"할인 추가"})]})]}),e.jsx("button",{onClick:D,className:"bg-green-500 text-white px-2 py-1 rounded hover:bg-green-600 mt-2",children:"수정 완료"})]}):e.jsxs("div",{children:[d.discounts.map((i,h)=>e.jsx("div",{className:"mb-2",children:e.jsxs("span",{children:[i.quantity,"개 이상 구매 시"," ",i.rate*100,"% 할인"]})},h)),e.jsx("button",{"data-testid":"modify-button",onClick:()=>q(d),className:"bg-blue-500 text-white px-2 py-1 rounded hover:bg-blue-600 mt-2",children:"수정"})]})})]},d.id))})]})},X=({newCoupon:t,setNewCoupon:s,onSubmit:a})=>e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx(b,{id:"coupon-name",type:"text",placeholder:"쿠폰 이름",value:t.name,onChange:n=>s({...t,name:n.target.value})}),e.jsx(b,{id:"coupon-code",type:"text",placeholder:"쿠폰 코드",value:t.code,onChange:n=>s({...t,code:n.target.value})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("select",{value:t.discountType,onChange:n=>s({...t,discountType:n.target.value}),className:"w-full p-2 border rounded",children:[e.jsx("option",{value:"amount",children:"금액(원)"}),e.jsx("option",{value:"percentage",children:"할인율(%)"})]}),e.jsx(b,{id:"discount-value",type:"number",placeholder:"할인 값",value:t.discountValue,onChange:n=>s({...t,discountValue:parseInt(n.target.value)})})]}),e.jsx("button",{onClick:a,className:"w-full bg-green-500 text-white p-2 rounded hover:bg-green-600",children:"쿠폰 추가"})]}),Z=({coupon:t,index:s})=>e.jsxs("div",{"data-testid":`coupon-${s+1}`,className:"bg-gray-100 p-2 rounded",children:[t.name," (",t.code,"):",T(t.discountType,t.discountValue)," 할인"]},t.code),ee=({coupons:t})=>t.length===0?e.jsx("p",{className:"text-sm text-gray-500",children:"등록된 쿠폰이 없습니다."}):e.jsx("div",{className:"space-y-2",children:t.map((s,a)=>e.jsx(Z,{coupon:s,index:a},a))}),te=({coupons:t,onCouponAdd:s})=>{const[a,n]=y.useState({name:"",code:"",discountType:"percentage",discountValue:0}),c=()=>{s(a),n({name:"",code:"",discountType:"percentage",discountValue:0})};return e.jsxs("div",{children:[e.jsx(C,{sectionTitle:"쿠폰 관리"}),e.jsxs(v,{children:[e.jsx(X,{newCoupon:a,setNewCoupon:n,onSubmit:c}),e.jsx(ee,{coupons:t})]})]})},ce=({products:t,coupons:s,onProductUpdate:a,onProductAdd:n,onCouponAdd:c})=>e.jsxs(P,{title:"관리자 페이지",children:[e.jsx(K,{products:t,onProductUpdate:a,onProductAdd:n}),e.jsx(te,{coupons:s,onCouponAdd:c})]}),ie=[{name:"5000원 할인 쿠폰",code:"AMOUNT5000",discountType:f.AMOUNT,discountValue:5e3},{name:"10% 할인 쿠폰",code:"PERCENT10",discountType:f.PERCENTAGE,discountValue:10}],re=[{id:"p1",name:"상품1",price:1e4,stock:20,discounts:[{quantity:10,rate:.1},{quantity:20,rate:.2}]},{id:"p2",name:"상품2",price:2e4,stock:20,discounts:[{quantity:10,rate:.15}]},{id:"p3",name:"상품3",price:3e4,stock:20,discounts:[{quantity:10,rate:.2}]}];export{ce as A,ae as C,re as P,ie as a};
